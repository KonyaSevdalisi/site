<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Karanlık Tıklama | Otomatik Kazanç Eklendi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap');

        body {
            font-family: 'Rajdhani', sans-serif;
            background-color: #0f172a; /* Slate 900 */
            user-select: none;
            overflow: hidden;
        }

        /* Tıklama Efekti Animasyonu */
        .click-anim {
            animation: pulse-click 0.1s ease-in-out;
        }

        @keyframes pulse-click {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }

        /* Uçan Yazı (Kazanılan Para) Animasyonu */
        .float-text {
            position: absolute;
            color: #4ade80; /* Green 400 */
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            z-index: 50;
            text-shadow: 0 0 5px rgba(74, 222, 128, 0.5);
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-50px) scale(1.2); }
        }

        /* Karakterin (Küre) Parlaması */
        .orb-glow {
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
        }
        .orb-glow:hover {
            box-shadow: 0 0 50px rgba(139, 92, 246, 0.6);
            cursor: pointer;
        }

        /* Kaydırma Çubuğu Özelleştirme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Admin Panel Animasyonu */
        #admin-panel {
            transition: opacity 0.2s ease-in-out;
        }

        /* Arkaplan Hayalet Animasyonu */
        .ghost-bg-anim {
            position: absolute;
            color: rgba(241, 245, 249, 0.6); 
            pointer-events: none;
            z-index: 5; 
            animation: floatSway 4s ease-in-out forwards;
            filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); 
        }

        @keyframes floatSway {
            0% { 
                transform: translate(0, 100vh) scale(0.5) rotate(0deg); 
                opacity: 0; 
            }
            10% { opacity: 0.8; } 
            25% { transform: translate(40px, 75vh) scale(0.7) rotate(10deg); }
            50% { transform: translate(-40px, 50vh) scale(0.9) rotate(-10deg); opacity: 0.8; }
            75% { transform: translate(40px, 25vh) scale(1.1) rotate(10deg); }
            100% { 
                transform: translate(0, -20vh) scale(1.3) rotate(0deg); 
                opacity: 0; 
            }
        }

        /* Panel Geçiş Animasyonları */
        .panel-transition {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="h-screen w-screen text-slate-200 flex flex-col md:flex-row overflow-hidden relative">

    <!-- OYUN SIFIRLAMA ONAY MODALI -->
    <div id="reset-modal" class="hidden fixed inset-0 bg-black/70 z-[110] flex items-center justify-center backdrop-blur-sm">
        <div class="bg-slate-800 p-6 rounded-xl border border-red-500/50 w-80 shadow-2xl">
            <h3 class="text-xl font-bold text-red-400 mb-3"><i class="fas fa-exclamation-triangle mr-2"></i>Emin Misiniz?</h3>
            <p class="text-slate-300 mb-6">Tüm oyun ilerlemesi, para ve eşyalarınız kalıcı olarak silinecektir.</p>
            <div class="flex justify-end space-x-3">
                <button onclick="hideResetModal()" class="bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded transition-colors">
                    İptal
                </button>
                <button onclick="confirmReset()" class="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-4 rounded transition-colors">
                    <i class="fas fa-trash-alt mr-2"></i>Sıfırla
                </button>
            </div>
        </div>
    </div>


    <!-- YÖNETİCİ PANELİ (MODAL) -->
    <div id="admin-panel" class="hidden fixed inset-0 bg-black/80 z-[100] flex items-center justify-center backdrop-blur-sm">
        <div class="bg-slate-900 p-8 rounded-2xl border border-purple-500/50 w-96 shadow-2xl relative">
            <button onclick="toggleAdminPanel()" class="absolute top-4 right-4 text-slate-500 hover:text-white">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold text-purple-400 mb-6 flex items-center">
                <i class="fas fa-tools mr-3"></i> Geliştirici Paneli
            </h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Mevcut Ruh (Para)</label>
                    <input type="number" id="input-money" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:border-purple-500 outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Tıklama Gücü</label>
                    <input type="number" id="input-power" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:border-purple-500 outline-none transition-colors">
                </div>
                <div>
                    <label class="block text-sm text-slate-400 mb-1">Saniyedeki Ruh (SPS)</label>
                    <input type="number" id="input-sps" class="w-full bg-slate-800 border border-slate-700 rounded p-2 text-white focus:border-purple-500 outline-none transition-colors">
                </div>
                <div class="pt-4 border-t border-slate-800 flex space-x-3">
                    <button onclick="saveAdminSettings()" class="flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded transition-colors">
                        <i class="fas fa-save mr-2"></i>Kaydet
                    </button>
                    <button onclick="showResetModal()" class="bg-red-900/50 hover:bg-red-600 border border-red-900 hover:border-red-500 text-red-200 hover:text-white py-2 px-4 rounded transition-colors" title="Oyunu Sıfırla">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- PANEL AÇMA BUTONLARI (Gizlenmiş Kenar Çubukları İçin) -->
    <button id="left-open-btn" onclick="toggleLeftPanel()" class="hidden absolute left-0 top-1/2 transform -translate-y-1/2 bg-slate-800 text-purple-400 p-3 rounded-r-xl border-y border-r border-slate-700 hover:bg-slate-700 z-50 transition-all shadow-lg hover:pr-5 group">
        <i class="fas fa-chevron-right group-hover:scale-125 transition-transform"></i>
    </button>

    <button id="right-open-btn" onclick="toggleRightPanel()" class="hidden absolute right-0 top-1/2 transform -translate-y-1/2 bg-slate-800 text-yellow-500 p-3 rounded-l-xl border-y border-l border-slate-700 hover:bg-slate-700 z-50 transition-all shadow-lg hover:pl-5 group">
        <i class="fas fa-chevron-left group-hover:scale-125 transition-transform"></i>
    </button>

    <!-- SOL PANEL: İstatistikler ve Hedef -->
    <div id="left-panel" class="panel-transition w-full md:w-1/4 bg-slate-900 border-r border-slate-800 p-6 flex flex-col justify-between z-10 shadow-xl relative whitespace-nowrap">
        
        <!-- Gizleme Butonu (Sol) -->
        <button onclick="toggleLeftPanel()" class="absolute top-2 right-2 text-slate-600 hover:text-white p-2 transition-colors" title="Paneli Gizle">
            <i class="fas fa-chevron-left"></i>
        </button>

        <!-- Üst Bilgi -->
        <div>
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-3xl font-bold text-purple-400 tracking-wider"><i class="fas fa-ghost mr-2"></i>Clicker</h1>
                <!-- Admin Butonu (Gizli Kalacak) -->
                <button id="admin-button" onclick="toggleAdminPanel()" class="hidden text-slate-600 hover:text-purple-400 transition-colors p-2 rounded-full hover:bg-slate-800 mr-6" title="Admin Panelini Aç">
                    <i class="fas fa-cog text-xl"></i>
                </button>
            </div>
            
            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700 mb-4 shadow-lg">
                <p class="text-slate-400 text-sm uppercase tracking-wide">Mevcut Ruh (Para)</p>
                <div class="flex items-center mt-2">
                    <i class="fas fa-gem text-emerald-400 text-2xl mr-3"></i>
                    <span id="money-display" class="text-4xl font-bold text-white">0</span>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3 mb-4">
                <!-- Tıklama Gücü -->
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs uppercase tracking-wide">Tıklama Gücü</p>
                    <div class="flex items-center mt-1">
                        <i class="fas fa-hand-sparkles text-purple-400 text-lg mr-2"></i>
                        <span id="power-display" class="text-xl font-bold text-purple-200">+1</span>
                    </div>
                </div>
                <!-- Saniyedeki Ruh (YENİ EKLENDİ) -->
                <div class="bg-slate-800 p-3 rounded-xl border border-slate-700 shadow-lg">
                    <p class="text-slate-400 text-xs uppercase tracking-wide">Saniyede Ruh (SPS)</p>
                    <div class="flex items-center mt-1">
                        <i class="fas fa-hourglass-half text-yellow-400 text-lg mr-2"></i>
                        <span id="sps-display" class="text-xl font-bold text-yellow-200">0</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Hedef Paneli -->
        <div class="mt-6 bg-gradient-to-br from-slate-800 to-slate-900 p-5 rounded-xl border border-indigo-900/50 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-16 h-16 bg-indigo-500 blur-3xl opacity-20"></div>
            <h3 class="text-indigo-300 font-bold mb-3 border-b border-slate-700 pb-2">SIRADAKİ HEDEF</h3>
            
            <div id="target-info">
                <p id="target-name" class="text-lg text-white font-semibold truncate">Hesaplanıyor...</p>
                <p class="text-sm text-slate-400 mt-1">Fiyat: <span id="target-price" class="text-yellow-400">0</span></p>
                
                <div class="mt-3 pt-3 border-t border-slate-700/50">
                    <p class="text-xs text-slate-400 mb-1">Gereken Miktar:</p>
                    <p id="target-needed" class="text-red-400 font-bold text-xl">0</p>
                </div>
            </div>
            <div id="target-completed" class="hidden text-center py-4">
                <i class="fas fa-crown text-4xl text-yellow-500 mb-2"></i>
                <p class="text-emerald-400 font-bold">MARKETİN HAKİMİSİN!</p>
            </div>
        </div>
    </div>

    <!-- ORTA PANEL: Oyun Alanı -->
    <div id="center-panel" class="flex-1 bg-slate-950 relative flex flex-col items-center justify-center p-4 transition-all duration-300">
        <!-- Arkaplan efekti -->
        <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-slate-900 via-slate-950 to-black opacity-80 pointer-events-none"></div>
        
        <!-- Tıklanabilir Karakter -->
        <div id="click-area" class="relative z-10 group">
            <div id="main-character" class="w-64 h-64 bg-slate-800 rounded-full flex items-center justify-center orb-glow border-4 border-slate-700 group-hover:border-purple-500 transition-colors duration-300">
                <i class="fas fa-skull text-8xl text-slate-200 group-hover:text-purple-400 transition-colors duration-300"></i>
            </div>
            <!-- Altındaki gölge -->
            <div class="absolute -bottom-10 left-1/2 transform -translate-x-1/2 w-48 h-12 bg-black blur-xl opacity-50"></div>
        </div>

        <p class="mt-8 text-slate-500 z-10 animate-pulse font-semibold tracking-widest">RUH TOPLAMAK İÇİN TIKLA</p>
    </div>

    <!-- SAĞ PANEL: Market -->
    <div id="right-panel" class="panel-transition w-full md:w-1/4 bg-slate-900 border-l border-slate-800 flex flex-col z-10 shadow-xl h-full relative whitespace-nowrap">
        
        <!-- Gizleme Butonu (Sağ) -->
        <div class="absolute top-2 left-2 z-20">
            <button onclick="toggleRightPanel()" class="text-slate-600 hover:text-white p-2 transition-colors" title="Paneli Gizle">
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>

        <div class="p-5 pl-12 border-b border-slate-800 bg-slate-900">
            <h2 class="text-xl font-bold text-white"><i class="fas fa-store mr-2 text-yellow-500"></i>Karanlık Pazar</h2>
        </div>
        
        <!-- Eşya Listesi -->
        <div id="shop-container" class="flex-1 overflow-y-auto p-4 space-y-3">
            <!-- Market öğeleri JS ile buraya eklenecek -->
        </div>
    </div>
    
    <!-- Tıklama Ses Efekti -->
    <audio id="click-sound" preload="auto">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-game-click-1769.mp3" type="audio/mp3">
        Tarayıcınız ses öğesini desteklemiyor.
    </audio>

    <script>
        // --- Oyun Verileri ve Durumu ---
        let gameState = {
            money: 0,
            clickValue: 1, // Tıklama başına para
            sps: 0,        // Souls Per Second (Saniyedeki Ruh) - YENİ
            items: [
                // Tıklama Gücü Eşyaları
                { id: 1, type: 'click', name: "Paslı Hançer", cost: 15, power: 1, sps: 0, icon: "fa-khanda", bought: 0 },
                { id: 2, type: 'click', name: "Gölge Eldiveni", cost: 100, power: 5, sps: 0, icon: "fa-mitten", bought: 0 },
                { id: 3, type: 'click', name: "Ruh Feneri", cost: 500, power: 20, sps: 0, icon: "fa-lightbulb", bought: 0 },
                { id: 4, type: 'click', name: "Kemik Asa", cost: 2000, power: 50, sps: 0, icon: "fa-staff-snake", bought: 0 },
                { id: 5, type: 'click', name: "Vampir Dişi", cost: 7500, power: 150, sps: 0, icon: "fa-tooth", bought: 0 },
                { id: 6, type: 'click', name: "Karanlık Kitap", cost: 25000, power: 400, sps: 0, icon: "fa-book-skull", bought: 0 },
                // Yeni Tıklama Gücü Eşyaları
                { id: 7, type: 'click', name: "Lanetli Zincir", cost: 50000, power: 800, sps: 0, icon: "fa-chain", bought: 0 },
                { id: 8, type: 'click', name: "Azrailin Tırpanı", cost: 100000, power: 1000, sps: 0, icon: "fa-scythe", bought: 0 },
                { id: 9, type: 'click', name: "Boynuzlu Miğfer", cost: 500000, power: 5000, sps: 0, icon: "fa-helmet-battle", bought: 0 },
                { id: 10, type: 'click', name: "Sonsuzluk Mührü", cost: 2500000, power: 20000, sps: 0, icon: "fa-infinity", bought: 0 },
                
                // Otomatik Tıklama (Idle Income) Eşyası
                // Bu eşyanın 'power' değeri 0, 'sps' değeri 1'den başlıyor.
                { id: 100, type: 'idle', name: "Gölge Hizmetkarı", cost: 250, power: 0, sps: 1, icon: "fa-skull-crossbones", bought: 0 }
            ]
        };
        let isAdminMode = false; 

        // --- DOM Elementleri ---
        const moneyDisplay = document.getElementById('money-display');
        const powerDisplay = document.getElementById('power-display');
        const spsDisplay = document.getElementById('sps-display'); // YENİ SPS Display
        const mainCharacter = document.getElementById('main-character');
        const shopContainer = document.getElementById('shop-container');
        const targetName = document.getElementById('target-name');
        const targetPrice = document.getElementById('target-price');
        const targetNeeded = document.getElementById('target-needed');
        const targetInfo = document.getElementById('target-info');
        const targetCompleted = document.getElementById('target-completed');
        const resetModal = document.getElementById('reset-modal');
        
        // Admin Elementleri
        const adminPanel = document.getElementById('admin-panel');
        const inputMoney = document.getElementById('input-money');
        const inputPower = document.getElementById('input-power');
        const inputSPS = document.getElementById('input-sps'); // YENİ SPS Input
        const adminButton = document.getElementById('admin-button');

        // Panel Elementleri
        const leftPanel = document.getElementById('left-panel');
        const rightPanel = document.getElementById('right-panel');
        const leftOpenBtn = document.getElementById('left-open-btn');
        const rightOpenBtn = document.getElementById('right-open-btn');

        // Ses Elementi 
        const clickSound = document.getElementById('click-sound');

        // --- PERSISTENCE (KAYDETME/YÜKLEME) ---
        const SAVE_KEY = 'karanlikTıklamaSave';

        function saveGame() {
            // Sadece gerekli state'i kaydet
            const saveObject = {
                money: gameState.money,
                clickValue: gameState.clickValue,
                sps: gameState.sps, // YENİ: sps'i kaydet
                items: gameState.items.map(item => ({ id: item.id, cost: item.cost, bought: item.bought }))
            };
            localStorage.setItem(SAVE_KEY, JSON.stringify(saveObject));
        }

        function loadGame() {
            const savedData = localStorage.getItem(SAVE_KEY);
            if (savedData) {
                const loadedData = JSON.parse(savedData);
                gameState.money = loadedData.money || 0;
                gameState.clickValue = loadedData.clickValue || 1;
                gameState.sps = loadedData.sps || 0; // YENİ: sps'i yükle
                
                // Item state'lerini yükle
                if (loadedData.items) {
                    loadedData.items.forEach(loadedItem => {
                        const existingItem = gameState.items.find(i => i.id === loadedItem.id);
                        if (existingItem) {
                            existingItem.cost = loadedItem.cost || existingItem.cost;
                            existingItem.bought = loadedItem.bought || 0;
                        }
                    });
                }
            }
        }

        // --- PANEL KONTROL FONKSİYONLARI ---
        function toggleLeftPanel() {
            if (leftPanel.classList.contains('w-0')) {
                // Aç
                leftPanel.classList.remove('w-0', 'p-0', 'opacity-0', 'border-0', 'overflow-hidden');
                leftPanel.classList.add('w-full', 'md:w-1/4', 'p-6', 'opacity-100', 'border-r');
                leftOpenBtn.classList.add('hidden');
            } else {
                // Kapat
                leftPanel.classList.remove('w-full', 'md:w-1/4', 'p-6', 'opacity-100', 'border-r');
                leftPanel.classList.add('w-0', 'p-0', 'opacity-0', 'border-0', 'overflow-hidden');
                leftOpenBtn.classList.remove('hidden');
            }
        }

        function toggleRightPanel() {
            if (rightPanel.classList.contains('w-0')) {
                // Aç
                rightPanel.classList.remove('w-0', 'p-0', 'opacity-0', 'border-0', 'overflow-hidden');
                rightPanel.classList.add('w-full', 'md:w-1/4', 'opacity-100', 'border-l');
                rightOpenBtn.classList.add('hidden');
            } else {
                // Kapat
                rightPanel.classList.remove('w-full', 'md:w-1/4', 'opacity-100', 'border-l');
                rightPanel.classList.add('w-0', 'p-0', 'opacity-0', 'border-0', 'overflow-hidden');
                rightOpenBtn.classList.remove('hidden');
            }
        }

        // --- Temel Fonksiyonlar ---

        function updateUI() {
            moneyDisplay.textContent = Math.floor(gameState.money).toLocaleString();
            powerDisplay.textContent = "+" + gameState.clickValue.toLocaleString();
            spsDisplay.textContent = gameState.sps.toLocaleString(); // YENİ: SPS gösterimi
            
            // Admin butonunu sadece admin modunda göster
            if (isAdminMode) {
                adminButton.classList.remove('hidden');
            } else {
                adminButton.classList.add('hidden');
            }

            gameState.items.forEach(item => {
                const btn = document.getElementById(`btn-buy-${item.id}`);
                const buyTextEl = btn ? btn.querySelector('.buy-text') : null;

                if (btn) {
                     // Satın alınmış adedini güncelle
                    const countEl = btn.querySelector('.item-count');
                    if (countEl) countEl.textContent = ` (x${item.bought})`;

                    if (gameState.money >= item.cost) {
                        btn.classList.remove('opacity-50', 'cursor-not-allowed', 'grayscale');
                        btn.classList.add('hover:bg-slate-700', 'cursor-pointer', 'border-slate-600');
                        if(buyTextEl) {
                            buyTextEl.textContent = "SATIN AL";
                            buyTextEl.classList.add('text-green-400');
                            buyTextEl.classList.remove('text-red-500');
                        }
                    } else {
                        btn.classList.add('opacity-50', 'cursor-not-allowed', 'grayscale');
                        btn.classList.remove('hover:bg-slate-700', 'cursor-pointer', 'border-slate-600');
                        if(buyTextEl) {
                            buyTextEl.textContent = "YETERSİZ";
                            buyTextEl.classList.remove('text-green-400');
                            buyTextEl.classList.add('text-red-500');
                        }
                    }
                }
            });

            updateTargetInfo();
        }

        function updateTargetInfo() {
            // Sadece tıklama gücü veya sps artışı sağlayan eşyaları hedef al
            let nextTarget = gameState.items.find(item => item.cost > gameState.money);

            if (!nextTarget) {
                // Tüm market listesi kontrol edilmediği için bu durum nadirdir, ancak yine de gösterelim
                targetInfo.classList.add('hidden');
                targetCompleted.classList.remove('hidden');
                return;
            }

            targetInfo.classList.remove('hidden');
            targetCompleted.classList.add('hidden');

            targetName.textContent = nextTarget.name;
            targetPrice.textContent = nextTarget.cost.toLocaleString();

            const needed = nextTarget.cost - gameState.money;
            
            if (needed <= 0) {
                targetNeeded.textContent = "ALINABİLİR!";
                targetNeeded.className = "text-emerald-400 font-bold text-xl animate-pulse";
            } else {
                targetNeeded.textContent = needed.toLocaleString();
                targetNeeded.className = "text-red-400 font-bold text-xl";
            }
        }

        function createShop() {
            shopContainer.innerHTML = "";
            gameState.items.forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.id = `btn-buy-${item.id}`;
                // Başlangıçta inaktif görünüyor
                itemEl.className = "bg-slate-800 p-3 rounded-lg border border-slate-700 flex items-center justify-between transition-all duration-200 opacity-50 cursor-not-allowed grayscale select-none";
                itemEl.onclick = () => buyItem(item);

                // Eşya açıklaması: Tıklama gücü mü, yoksa SPS mi?
                let description;
                if (item.type === 'click') {
                    description = `+${item.power} Tıklama Gücü`;
                } else if (item.type === 'idle') {
                    description = `+${item.sps} Saniyede Ruh (SPS)`;
                }

                itemEl.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center ${item.type === 'idle' ? 'text-yellow-400' : 'text-purple-400'}">
                            <i class="fas ${item.icon}"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-sm text-slate-200">${item.name}<span class="item-count text-slate-500 ml-1"> (x${item.bought})</span></h4>
                            <p class="text-xs text-slate-500">${description}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-yellow-500 font-bold text-sm"><i class="fas fa-gem text-xs mr-1"></i>${item.cost.toLocaleString()}</div>
                        <div class="buy-text text-[10px] font-bold mt-1 text-red-500">YETERSİZ</div>
                    </div>
                `;
                shopContainer.appendChild(itemEl);
            });
        }

        function buyItem(item) {
            if (gameState.money >= item.cost) {
                gameState.money -= item.cost;
                item.bought += 1; 

                // Yeni: Eşya tipine göre güçlendirme uygula
                if (item.type === 'click') {
                    gameState.clickValue += item.power;
                } else if (item.type === 'idle') {
                    gameState.sps += item.sps;
                }
                
                item.cost = Math.floor(item.cost * 1.25); // Maliyeti artır
                
                const btn = document.getElementById(`btn-buy-${item.id}`);
                btn.classList.add('ring-2', 'ring-green-500');
                setTimeout(() => btn.classList.remove('ring-2', 'ring-green-500'), 200);

                createShop(); // Market UI'ını yeniden oluştur
                saveGame(); 
                updateUI();
            }
        }

        // --- OYUN DÖNGÜSÜ (IDLE INCOME) ---
        function gameLoop() {
            // Saniyedeki ruhu paraya ekle
            if (gameState.sps > 0) {
                // Saniyede 1 kez eklemek yerine, 100ms'de bir saniyenin 1/10'unu ekleyerek daha akıcı bir artış sağlarız
                const incrementalSPS = gameState.sps / 10;
                gameState.money += incrementalSPS;
                
                // Her saniye başı görsel geri bildirim verelim (sabit noktada)
                if (Date.now() % 1000 < 100) { 
                    showFloatingText(window.innerWidth / 2, window.innerHeight / 2 - 100, `+${gameState.sps} (SPS)`);
                }
                
                saveGame();
                updateUI();
            }
        }
        
        // Döngüyü başlat (100ms'de bir çalışır)
        setInterval(gameLoop, 100); 

        // --- GİZLİ KOMUT (ADMIN PANEL AKTİVASYONU) ---
        const SECRET_CODE = ['a', 'd', 'm', 'i', 'n']; // "admin" (Admin) komutu
        let keySequenceIndex = 0;

        function activateAdminMode() {
            if (isAdminMode) return; // Zaten aktifse tekrar çalıştırma

            isAdminMode = true;
            updateUI();
            console.log("Gizli Komut Başarılı! Admin Modu Aktif Edildi. Ayarlar butonu görünüyor.");
            showFloatingText(window.innerWidth / 2, window.innerHeight / 2, "ADMIN MODU AÇIK!");
            toggleAdminPanel(); // Paneli otomatik aç
        }

        document.addEventListener('keydown', (e) => {
            // Küçük harfe dönüştür
            const key = e.key.toLowerCase();
            
            // Basılan tuş beklenen tuş mu?
            if (key === SECRET_CODE[keySequenceIndex]) {
                keySequenceIndex++; // Sıradaki tuşa geç
                
                // Komut tamamlandı mı?
                if (keySequenceIndex === SECRET_CODE.length) {
                    activateAdminMode();
                    keySequenceIndex = 0; // Komutu sıfırla
                }
            } else {
                // Yanlış tuşa basıldı, sırayı sıfırla
                keySequenceIndex = 0;
                
                // Eğer basılan tuş, sıranın ilk tuşuysa, sırayı 1'den başlat
                if (key === SECRET_CODE[0]) {
                     keySequenceIndex = 1;
                }
            }
        });


        // --- YÖNETİCİ PANELİ ---
        function toggleAdminPanel() {
            if (!isAdminMode) return; 

            adminPanel.classList.toggle('hidden');
            if (!adminPanel.classList.contains('hidden')) {
                inputMoney.value = Math.floor(gameState.money);
                inputPower.value = gameState.clickValue;
                inputSPS.value = gameState.sps; 
            }
        }

        function saveAdminSettings() {
            const newMoney = parseInt(inputMoney.value);
            const newPower = parseInt(inputPower.value);
            const newSPS = parseInt(inputSPS.value); 
            
            if (!isNaN(newMoney) && newMoney >= 0) gameState.money = newMoney;
            if (!isNaN(newPower) && newPower >= 1) gameState.clickValue = newPower;
            if (!isNaN(newSPS) && newSPS >= 0) gameState.sps = newSPS; 
            
            saveGame(); 
            updateUI();
            toggleAdminPanel();
            showFloatingText(window.innerWidth / 2, window.innerHeight / 2, "HİLE AKTİF!");
        }

        // SIFIRLAMA MODAL KONTROLLERİ
        function showResetModal() {
            resetModal.classList.remove('hidden');
        }

        function hideResetModal() {
            resetModal.classList.add('hidden');
        }

        function confirmReset() {
            localStorage.removeItem(SAVE_KEY); // Kaydı sil
            location.reload(); // Sayfayı yenile ve oyunu sıfırla
        }
        
        function resetGame() {
            showResetModal();
        }


        // --- Ses Çalma Fonksiyonu ---
        function playClickSound() {
            clickSound.currentTime = 0;
            try {
                clickSound.play();
            } catch (error) {
                console.error("Ses çalınamadı (Tarayıcı otomatik oynatma engeli olabilir):", error);
            }
        }

        // --- Tıklama Olayları ---
        mainCharacter.addEventListener('mousedown', (e) => {
            mainCharacter.parentElement.classList.remove('click-anim');
            void mainCharacter.parentElement.offsetWidth; // Force reflow
            mainCharacter.parentElement.classList.add('click-anim');

            gameState.money += gameState.clickValue;
            
            playClickSound();

            spawnGhost();

            saveGame(); 
            updateUI();
            showFloatingText(e.clientX, e.clientY, `+${gameState.clickValue}`);
        });

        function spawnGhost() {
            const ghost = document.createElement('i');
            ghost.className = 'fas fa-ghost ghost-bg-anim';
            const size = 3 + Math.random() * 4; 
            ghost.style.fontSize = `${size}rem`;
            
            const randomX = Math.random() * (window.innerWidth - 100); 
            ghost.style.left = `${randomX}px`;
            ghost.style.bottom = '-150px';

            document.body.appendChild(ghost);
            setTimeout(() => { ghost.remove(); }, 4000); 
        }

        function showFloatingText(x, y, text) {
            const el = document.createElement('div');
            el.className = 'float-text';
            el.textContent = text;
            const randomX = (Math.random() - 0.5) * 40;
            el.style.left = `${x + randomX}px`;
            el.style.top = `${y - 20}px`;
            document.body.appendChild(el);
            setTimeout(() => { el.remove(); }, 1000);
        }

        // --- Başlangıç ---
        loadGame(); // Oyunu yükle
        createShop(); // Market UI'ını oluştur
        updateUI(); // Arayüzü güncelle

    </script>
</body>
</html>
